# 代码规范.md
如何做code review :https://juejin.cn/post/6844903959593746439

0、是否按照开发方案进行开发
1、变量名及方法名是否规范统一
2、注释的代码是否删除、是否有清晰的代码注释
3、代码可复用的部分是否有抽离并封装
4、方法传参是否合理
5、项目中涉及到的地址是否单独写成配置文件
6、页面请求是否合理，是否没有不必要的请求
7、请求需要加锁的地方是否有加锁
8、是否有进行接口返回数据的容错处理
9、ajax请求的超时时间是否设置为3s、是否有设置缓存cache
10、项目中使用的字体、图片、第三方库等是否涉及到侵权
11、是否有做iphoneX、折叠屏等适配
12、页面中是否有写http，https等协议头（客户端协议除外）
13、图片是否有进行压缩（push场景300K）
14、静态资源服务器的资源引用地址时间戳是否正确（io.thsi.cn / so.thsi.cn），不能使用？的方式
15、setInterval定时器是否有清除
16、埋点的书写是否合理（活动透传、v2.12/stat.js）
17、vue相关：v-for设置键值、模板中不出现复杂的计算、合理的使用v-if或v-show、指令缩写
18、打开页面查看页面显示是否正常（用户名、手机号是否打码处理）
19、页面中必须写 <meta name="rem" content="design-width=750">
20、页面中必须引用初始化的css和js，不要使用cb方式引用初始化样式库
21、手机号密码等需要rsa加密
22、项目的deploy.sh中是否包含了代码检查

约定
vue 项目

在created中进行数据请求

mounted中不操作dom

$nextTick(() => {}) 与DOM相关操作写在该函数回调中，确保DOM已渲染后才执行里面的回调函数。

低级bug
取变量的时候，需要做保护
标签闭合 from 
html 标签上，添加多个id，比如：<div id='id1 id2'></div>.  by 王成 
减少冗余代码
一个样式设置在了 html , body, #app {background-color: #fff; width: 100%} ，刚好能解决问题。但是不能定位具体到某个标签。最后结果是只需要给 html 设置样式，就能解决问题。这里要求同学在定位问题、解决问题的时候，需要更仔细些。首先定位到真正影响问题的地方，再对代码进行优化。而不是刚好，这段代码能解决问题，就直接提测了。from zhouzhiwei
一些场景下，需要做样式覆盖。那么应该优先考虑使用 样式优先级的生效策略，设置 class 的层级去做覆盖，减少 !important 的使用，减少交集样式的使用，例如：".class1.class2"，一般情况下，".class1" 就可以满足需求了。from wujunchen
编码规范
数据 list 的筛选项，需要通过服务端获取。

`var d = new Date('2021-06-24') // good`
`var d1 = new Date(2021,5,24) // bad`

查删系统代码问题总结
1. 开发已有项目时，对于基础通用功能和已经实现过的方法需要看懂工作逻辑，不要在没有看懂的情况下修改、调用，会导致代码复杂度提高。
2. 开发已有项目时，需要用到的非业务相关的功能，例如各种格式化处理，接口发送等功能，找找有没有已经实现的方法，找不到去问之前的开发，之前的开发都不在再考虑自己实现（引用第三方组件一两行代码就能实现的功能不需要封装）
3. 合理使用js内建方法，对字符串先用 “,” 分割然后再用 “/” 拼接这一操作可以直接用 replace 方法替换，不应该先分割再拼接。
4. 使用 scoped 的目的是防止样式泄漏影响其他页面，再在 scoped 中的顶级样式中使用 ::v-deep 穿透 scoped 相当于没有写 scoped。正确做法是在外层添加属于当前组件的选择器，再在里面使用 ::v-deep。
5. 不要使用无意义的简写，将 index 简写成 idx 只会增加代码阅读成本，因为作用域的原因无法使用 index 时写 i 都更好，或者重新命名比如 xxxIndex。
6. 使用 v-if v-else-if 并列选择多个节点，并且内容只有文本不同，应该使用 methods 或者 computed 直接确定文本并使用插值插入节点中。
7. el-table-column 的 slot 中 slot-scope 是恒拥有 row 属性的，因此不需要使用 v-if 进行一次判断即可直接使用的。况且其他地方的修改就没有写这个v-if 从代码的统一角度讲也不应该。
8. 绑定到节点的点击事件，没有必须要传递的参数时应该直接写函数名，直接写带括号的函数相当于执行函数，vue 将其作为语句包在匿名函数中绑定给节点，这一操作是冗余并增加代码复杂度的。
9. 秒时间戳转换为毫秒时间戳直接用数字乘以 1000 即可，将数字和字符串相加隐式转换为字符串然后再用 Number 强制换换为数字是不对的。
10. 如果需要将一个数组处理后的结果作为另一个数组使用，直接使用 map 方法即可，map 设计就是做这个用的，只有在不关心返回值时才需要使用 forEach。
11. 代码需要注释，没有注释的代码只能算是半成品。写注释的方法网上有很多，可以自己学习吸收。我的思路是每个方法都尽量写注释，说明方法作用，虽然方法名可以自述，逻辑也不一定复杂，但是可以减少不必要的代码阅读；自己反复修改过的逻辑需要些注释，写明修改过程和心得，可能最后精简过的代码只有几行，但是精简就意味着这里有的逻辑可能有较多牵连，曾经复杂的代码就是自己踩过的坑，将详情写明可以方便日后维护；剩下就是其他自己认为有必要说明的地方，比如一些需求特殊要求的地方，代码潜规则等，总之就是自己认为新接手这个代码的人可能需要了解的东西。

为什么需要规范
所谓“书同文、车同轨”，规范带来的标准化、统一化会带来沟通协作效率的很大提升。另外，因为有规范约束，比如代码规范，可以减少或避免技术债的积累，降低日后维护工作的成本。同时，好的规范会帮助开发避免一些低级的失误，间接提高应用的稳定性。简言之，规范可以类比于法典，它是整个前端技术体系的根基，是效率、质量、稳定性的基础。

前端需要哪些规范
和其他很多技术栈一样，前端需要最基础的规范，也需要一些技术栈相关的规范。以下整理的这些规范覆盖了前端规范中大部分的内容。


代码规范。前端代码规范包括了 HTML、CSS、Javascript、Typescript、Vue、React 规范。其中 HTML、CSS、Javascript 是最基础的通用规范，和技术栈无关。
流程规范。流程规范指的是从需求开始到发布上线过程中，前端相关工作流的规范。包含Git 工作流规范、JIRA 工作流规范、Code Review 流程规范、上下游协作规范等。
工程规范。代码层面通过代码规范保持统一，整个前端工程也需要有规范约束，确保前端工程在目录结构、命名规则、包管理方式等方面保持一致，并且遵守前端工程最佳实践。
性能规范。前端性能至关重要。对用户留存、用户体验、业务营收都有重要的影响。所以需要有相关的规范来明确性能标准。前端性能通常分为加载时性能和运行时性能。
组件规范。前端开发非常依赖 UI 组件，好的 UI 组件库能够大大节省前端开发的时间。但缺少良好设计和统一的标准会影响组件的复用率，另外，组件的开发和管理也需要有规范。
安全规范。安全并不带来直接的收益，但能避免可能的巨大损失。前端常见的安全问题包括 XSS、CSRF、点击劫持等，需要针对这些问题制定一些安全规范。另外，也需要有三方包使用的安全规范。




目前前端规范落实情况
经过调研，部分业务线有代码规范的文本，比如基金 ，但大部分业务线都缺少代码规范以及配套的落地工具。此外，其他规范普遍都缺失，比如没有工程规范约束是否要在版本管理中带入包管理的 package-lock.json 文件，导致安全依赖扫描工具更难推行。再比如缺失通用的组件规范，这导致的问题是，不同的平台不能复用各自开发的组件，存在很多重复工作的时间浪费。所以制定规范，并开发配套的工具帮助落地，是重要且相对紧急的事情。


如何制定并落地规范
规范是整个团队的共识，是一种集体审美。所以规范的制定需要依托团队而非某个人。前端会通过技术委员会来制定规范，由前端基建小组来开发相关的工具，并和各业务组长一起配合推进实施。具体的过程以代码规范为例，大致可以分为以下几个步骤：

一、整理最佳实践并制定规范文本

很多业界知名的公司比如 airbnb、google 等根据实践积累已经有相对成熟靠谱的规范文本。我们在制定规范的时候需要参考它们的文本，理解每一条规则背后的理由，这对我们自己制定出合理的规范有很大帮助。以下是目前前端代码规范相关的业界实践：

JavaScript Standard Style. https://standardjs.com/rules.html
Google JavaScript Style Guide. https://google.github.io/styleguide/jsguide.html
Google HTML/CSS Style Guide. https://google.github.io/styleguide/htmlcssguide.html
Airbnb JavaScript Style Guide. https://github.com/airbnb/javascript
Code Guide by AlloyTeam. https://alloyteam.github.io/CodeGuide/
二、结合公司情况将规范内化到工作流

规范的执行不能依赖人的自觉，需要结合公司的情况将规范工具化、自动化到工作流程中。目前公司内部使用 Sonar 来做代码的静态检查，并且在 CI 阶段有相关的插件可以集成到工作流中。所以我们需要将制定的规范中的每一条文本规则转换成 Sonar 检测规则，并且将 Sonar 的检测结果作为考评的一部分让遵守代码规范真正成为前端工作中的一部分。

三、推广落地并在具体实践中微调规范

有了规范文本和相关工具，可以以试点的方式在某个业务线中使用，并收集可能存在的问题和优化建议。在试点成功后，再向其他业务线做更大范围的推广，并继续在推广过程中根据需要对规范做微调，最终形成相对更完善的规范以及配套工具。


review 规范

通用
不清楚的业务代码，不允许删除或者修改
需要在JIRA上留痕修改原因，方便以后的人来溯源历史业务(代码中的注释备注要做这个改动的JIRA)


前端
命名：
不能使用中文拼音 eg: tebielist注释：以下情况都需要添加注释



新规则：
 1.  函数类


2. dom类
  2.1 Vue
    2.1.1 不允许出现过长的dom，需做换行处理，便于阅读

    

   2.1.2 dom里不要出现 :style 的写法，如需要，请以计算属性替之（避免更新dom重复计算）

  

2.2 React
  2.2.1 新模块，能使用hooks就使用hook写法，不再使用ReactDomClass 

  2.2.2 能使用 useCallBack 等语法糖提升性能的函数，都必须使用，避免性能消耗。



2.3 Typescript
  2.3.1 拒绝any，不允许使用any。

  2.3.2 官方文档：  https://www.tslang.cn/docs/handbook/basic-types.html

3. css类
 3.1 不要使用奇怪的命名。
 3.2 必须添加scope
 3.3 不允许随意添加全局样式。